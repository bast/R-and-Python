<!DOCTYPE html>
<html lang="en">
  <head>
    <title>R for Python developers and Python for R developers</title>
    <link rel="shortcut icon" href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;/img/favicon.ico">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- uikit -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.19/dist/css/uikit.min.css" integrity="sha256-f3SVFXP30MgahZ0Z7Lp1W02MuLgtiAtk8uFqTbGxNfY=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.19/dist/js/uikit.min.js" integrity="sha256-gHEvLzvpjU93VFTgu5myAgmc+0I1CzBzYe0YhTJ8uqI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.19/dist/js/uikit-icons.min.js" integrity="sha256-PxrcCuBlFkPVlPsGxNzt59W3EKYOH79z+v/tq9uFS2M=" crossorigin="anonymous"></script>

    <link href="https://bast.github.io/R-and-Python/style.css" rel="stylesheet">
  </head>

  <body>
    <div class="uk-container uk-container-expand uk-margin-large-bottom uk-margin-large-top">

      <div class="markdown">
        <div uk-grid>
          <div class="uk-width-1-4@m">
            

<ul>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;shell/">Starting an interactive shell</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;script/">Running a script</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;command/">Running from command line</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;vectors/">Tuples&#x2F;lists&#x2F;vectors</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;lists/">Dictionaries (Python)&#x2F; lists (R)</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;filter/">Filtering</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;functions/">Functions</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;help/">Getting help</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;pitfalls/">Pitfalls that surprise</a>
    </li>
  
    <li>
      <a href="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;profiling/">Profiling memory and CPU time</a>
    </li>
  
</ul>

          </div>
          <div class="uk-width-3-4@m">
            
  

  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      <h1>Profiling memory and CPU time</h1>
      

  <h2 id="profiling-memory-and-cpu-time-in-r">Profiling memory and CPU time in R</h2>
<p><a rel="noopener" target="_blank" href="https://rstudio.github.io/profvis/">Profvis</a> is one of the nicest ways in R to
get a line-by-line profile both for CPU time and memory.</p>
<p>We will need to add the following lines to our code:</p>
<pre data-lang="r" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-r "><code class="language-r" data-lang="r"><span style="color:#b39f04;">library</span><span>(profvis)
</span><span>
</span><span style="color:#7f8989;"># with this we make sure we can browse the source
</span><span style="color:#7f8989;"># code in the generated HTML page
</span><span style="color:#b39f04;">options</span><span>(</span><span style="color:#5597d6;">keep.source</span><span style="color:#72ab00;">=</span><span style="color:#b3933a;">TRUE</span><span>)
</span><span>
</span><span>p </span><span style="color:#72ab00;">= </span><span style="color:#5597d6;">profvis</span><span>({
</span><span>
</span><span style="color:#7f8989;"># here is the code you wish to profile ...
</span><span>
</span><span>})
</span><span>
</span><span>htmlwidgets::</span><span style="color:#5597d6;">saveWidget</span><span>(p, </span><span style="color:#d07711;">&quot;profile.html&quot;</span><span>)
</span></code></pre>
<p>Here is an actual example where we compare two ways of approximating pi using
the Monte-Carlo method. One version uses a for-loop, the other is vectorized:</p>
<pre data-lang="r" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-r "><code class="language-r" data-lang="r"><span style="color:#b39f04;">library</span><span>(profvis)
</span><span>
</span><span style="color:#7f8989;"># with this we make sure we can browse the source
</span><span style="color:#7f8989;"># code in the generated HTML page
</span><span style="color:#b39f04;">options</span><span>(</span><span style="color:#5597d6;">keep.source</span><span style="color:#72ab00;">=</span><span style="color:#b3933a;">TRUE</span><span>)
</span><span>
</span><span>p </span><span style="color:#72ab00;">= </span><span style="color:#5597d6;">profvis</span><span>({
</span><span>
</span><span>n </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b3933a;">1000000
</span><span>
</span><span>count </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b3933a;">0
</span><span>
</span><span style="color:#72ab00;">for </span><span>(i </span><span style="color:#72ab00;">in </span><span style="color:#b3933a;">1</span><span style="color:#72ab00;">:</span><span>n) {
</span><span>  </span><span style="color:#7f8989;"># generate random coordinates between 0 and 1
</span><span>  x </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b39f04;">runif</span><span>(</span><span style="color:#b3933a;">1</span><span>, </span><span style="color:#5597d6;">min </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0</span><span>, </span><span style="color:#5597d6;">max </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1</span><span>)
</span><span>  y </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b39f04;">runif</span><span>(</span><span style="color:#b3933a;">1</span><span>, </span><span style="color:#5597d6;">min </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0</span><span>, </span><span style="color:#5597d6;">max </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1</span><span>)
</span><span>
</span><span>  </span><span style="color:#7f8989;"># check if the point is within the unit circle
</span><span>  </span><span style="color:#72ab00;">if </span><span>(x</span><span style="color:#72ab00;">^</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+</span><span> y</span><span style="color:#72ab00;">^</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1</span><span>) {
</span><span>    count </span><span style="color:#72ab00;">&lt;-</span><span> count </span><span style="color:#72ab00;">+ </span><span style="color:#b3933a;">1
</span><span>  }
</span><span>}
</span><span>
</span><span style="color:#7f8989;"># calculate the value of pi
</span><span>approx_pi </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b3933a;">4 </span><span style="color:#72ab00;">*</span><span> count </span><span style="color:#72ab00;">/</span><span> n
</span><span style="color:#b39f04;">print</span><span>(approx_pi)
</span><span>
</span><span>
</span><span style="color:#7f8989;"># and now let us try with a vectorized version
</span><span style="color:#7f8989;"># </span><span style="color:#c23f31;">-</span><span style="color:#7f8989;">-------------------------------------------
</span><span>
</span><span style="color:#7f8989;"># generate a vector of random coordinates between 0 and 1
</span><span>x </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b39f04;">runif</span><span>(n, </span><span style="color:#5597d6;">min </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0</span><span>, </span><span style="color:#5597d6;">max </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1</span><span>)
</span><span>y </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b39f04;">runif</span><span>(n, </span><span style="color:#5597d6;">min </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0</span><span>, </span><span style="color:#5597d6;">max </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1</span><span>)
</span><span>
</span><span style="color:#7f8989;"># count how many points are within the unit circle
</span><span>count </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b39f04;">sum</span><span>(x</span><span style="color:#72ab00;">^</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+</span><span> y</span><span style="color:#72ab00;">^</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1</span><span>)
</span><span>
</span><span style="color:#7f8989;"># calculate the value of pi
</span><span>approx_pi </span><span style="color:#72ab00;">&lt;- </span><span style="color:#b3933a;">4 </span><span style="color:#72ab00;">*</span><span> count </span><span style="color:#72ab00;">/</span><span> n
</span><span style="color:#b39f04;">print</span><span>(approx_pi)
</span><span>
</span><span>})
</span><span>
</span><span>htmlwidgets::</span><span style="color:#5597d6;">saveWidget</span><span>(p, </span><span style="color:#d07711;">&quot;profile.html&quot;</span><span>)
</span></code></pre>
<p>The above example will generate a file called &quot;profile.html&quot; which you can open
and browse in your browser. An example is below here:</p>
<iframe src="https:&#x2F;&#x2F;bast.github.io&#x2F;R-and-Python&#x2F;profile.html" width="800px" height="1400px">
</iframe>
<p>If you want to try this out in a container, then this is the
Singularity/Apptainer definition file which I have used to test this:</p>
<pre style="background-color:#f5f5f5;color:#1f1f1f;"><code><span>Bootstrap: docker
</span><span>From: rstudio/r-base:focal
</span><span>
</span><span>%post
</span><span>    R_VERSION=4.3.0
</span><span>    OS_IDENTIFIER=ubuntu-2004
</span><span>
</span><span>    wget https://cdn.posit.co/r/${OS_IDENTIFIER}/pkgs/r-${R_VERSION}_1_amd64.deb &amp;&amp; \
</span><span>    apt-get update -qq &amp;&amp; \
</span><span>    DEBIAN_FRONTEND=noninteractive apt-get install -f -y ./r-${R_VERSION}_1_amd64.deb &amp;&amp; \
</span><span>    ln -s /opt/R/${R_VERSION}/bin/R /usr/bin/R &amp;&amp; \
</span><span>    ln -s /opt/R/${R_VERSION}/bin/Rscript /usr/bin/Rscript &amp;&amp; \
</span><span>    ln -s /opt/R/${R_VERSION}/lib/R /usr/lib/R &amp;&amp; \
</span><span>    rm r-${R_VERSION}_1_amd64.deb &amp;&amp; \
</span><span>    rm -rf /var/lib/apt/lists/*
</span><span>
</span><span>    R --quiet -e &quot;install.packages(&#39;profvis&#39;, repos=&#39;http://cran.us.r-project.org&#39;)&quot;
</span></code></pre>
<h2 id="line-by-line-cpu-profiling-in-python">Line-by-line CPU profiling in Python</h2>
<p>This example requires the <a rel="noopener" target="_blank" href="https://github.com/pyutils/line_profiler">line_profiler</a> package.</p>
<p>As an example we will compute approximate pi using the Monte-Carlo method
(<code>example.py</code>):</p>
<pre data-lang="python" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#72ab00;">import </span><span>random
</span><span>
</span><span>
</span><span>@</span><span style="color:#5597d6;">profile
</span><span style="color:#72ab00;">def </span><span style="color:#c23f31;">main</span><span>():
</span><span>    n </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1000000
</span><span>
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0
</span><span>
</span><span>    </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">range</span><span>(n):
</span><span>        </span><span style="color:#7f8989;"># generate random coordinates between 0 and 1
</span><span>        x </span><span style="color:#72ab00;">= </span><span>random.</span><span style="color:#5597d6;">random</span><span>()
</span><span>        y </span><span style="color:#72ab00;">= </span><span>random.</span><span style="color:#5597d6;">random</span><span>()
</span><span>
</span><span>        </span><span style="color:#7f8989;"># check if the point is within the unit circle
</span><span>        </span><span style="color:#72ab00;">if </span><span>x</span><span style="color:#72ab00;">**</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>y</span><span style="color:#72ab00;">**</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>:
</span><span>            count </span><span style="color:#72ab00;">+= </span><span style="color:#b3933a;">1
</span><span>
</span><span>    </span><span style="color:#7f8989;"># calculate the approximate value of pi
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>    coordinates </span><span style="color:#72ab00;">= </span><span>[(random.</span><span style="color:#5597d6;">random</span><span>(), random.</span><span style="color:#5597d6;">random</span><span>()) </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">range</span><span>(n)]
</span><span>
</span><span>    inside_unit_circle </span><span style="color:#72ab00;">= </span><span style="color:#a2a001;">list</span><span>(
</span><span>        </span><span style="color:#b39f04;">filter</span><span>(</span><span style="color:#72ab00;">lambda </span><span style="color:#5597d6;">c</span><span>: c[</span><span style="color:#b3933a;">0</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>c[</span><span style="color:#b3933a;">1</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>, coordinates)
</span><span>    )
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b39f04;">len</span><span>(inside_unit_circle)
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b39f04;">sum</span><span>(</span><span style="color:#b3933a;">1 </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">filter</span><span>(</span><span style="color:#72ab00;">lambda </span><span style="color:#5597d6;">c</span><span>: c[</span><span style="color:#b3933a;">0</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>c[</span><span style="color:#b3933a;">1</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>, coordinates))
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>
</span><span style="color:#5597d6;">main</span><span>()
</span></code></pre>
<p>Let us profile the code:</p>
<pre data-lang="console" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-console "><code class="language-console" data-lang="console"><span>$ kernprof -l -v example.py
</span><span>
</span><span>3.141016
</span><span>3.14008
</span><span>3.14008
</span><span>Wrote profile results to example.py.lprof
</span><span>Timer unit: 1e-06 s
</span><span>
</span><span>Total time: 1.75691 s
</span><span>File: example.py
</span><span>Function: main at line 4
</span><span>
</span><span>Line #      Hits         Time  Per Hit   % Time  Line Contents
</span><span>==============================================================
</span><span>     4                                           @profile
</span><span>     5                                           def main():
</span><span>     6         1          0.5      0.5      0.0      n = 1000000
</span><span>     7
</span><span>     8         1          0.2      0.2      0.0      count = 0
</span><span>     9
</span><span>    10   1000000     143593.2      0.1      8.2      for _ in range(n):
</span><span>    11                                                   # generate random coordinates between 0 and 1
</span><span>    12   1000000     188331.9      0.2     10.7          x = random.random()
</span><span>    13   1000000     180575.0      0.2     10.3          y = random.random()
</span><span>    14
</span><span>    15                                                   # check if the point is within the unit circle
</span><span>    16    785254     222825.2      0.3     12.7          if x**2 + y**2 &lt;= 1.0:
</span><span>    17    785254     120810.1      0.2      6.9              count += 1
</span><span>    18
</span><span>    19                                               # calculate the approximate value of pi
</span><span>    20         1         30.4     30.4      0.0      print(4.0 * count / n)
</span><span>    21
</span><span>    22         1     239801.0 239801.0     13.6      coordinates = [(random.random(), random.random()) for _ in range(n)]
</span><span>    23
</span><span>    24         1     304028.4 304028.4     17.3      inside_unit_circle = list(
</span><span>    25         1          3.5      3.5      0.0          filter(lambda c: c[0] ** 2 + c[1] ** 2 &lt;= 1.0, coordinates)
</span><span>    26                                               )
</span><span>    27         1          1.5      1.5      0.0      count = len(inside_unit_circle)
</span><span>    28         1         25.9     25.9      0.0      print(4.0 * count / n)
</span><span>    29
</span><span>    30         1     356858.8 356858.8     20.3      count = sum(1 for _ in filter(lambda c: c[0] ** 2 + c[1] ** 2 &lt;= 1.0, coordinates))
</span><span>    31         1         25.9     25.9      0.0      print(4.0 * count / n)
</span></code></pre>
<h2 id="line-by-line-memory-profiling-in-python">Line-by-line memory profiling in Python</h2>
<p>This example requires the <a rel="noopener" target="_blank" href="https://github.com/pythonprofilers/memory_profiler">memory_profiler</a> package.</p>
<p>The only change compared to the CPU profiling example (above) is that we add the line <code>from memory_profiler import profile</code> on top:</p>
<pre data-lang="python" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#72ab00;">from </span><span>memory_profiler </span><span style="color:#72ab00;">import </span><span>profile
</span><span style="color:#72ab00;">import </span><span>random
</span><span>
</span><span>
</span><span>@</span><span style="color:#5597d6;">profile
</span><span style="color:#72ab00;">def </span><span style="color:#c23f31;">main</span><span>():
</span><span>    n </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">1000000
</span><span>
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">0
</span><span>
</span><span>    </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">range</span><span>(n):
</span><span>        </span><span style="color:#7f8989;"># generate random coordinates between 0 and 1
</span><span>        x </span><span style="color:#72ab00;">= </span><span>random.</span><span style="color:#5597d6;">random</span><span>()
</span><span>        y </span><span style="color:#72ab00;">= </span><span>random.</span><span style="color:#5597d6;">random</span><span>()
</span><span>
</span><span>        </span><span style="color:#7f8989;"># check if the point is within the unit circle
</span><span>        </span><span style="color:#72ab00;">if </span><span>x</span><span style="color:#72ab00;">**</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>y</span><span style="color:#72ab00;">**</span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>:
</span><span>            count </span><span style="color:#72ab00;">+= </span><span style="color:#b3933a;">1
</span><span>
</span><span>    </span><span style="color:#7f8989;"># calculate the approximate value of pi
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>    coordinates </span><span style="color:#72ab00;">= </span><span>[(random.</span><span style="color:#5597d6;">random</span><span>(), random.</span><span style="color:#5597d6;">random</span><span>()) </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">range</span><span>(n)]
</span><span>
</span><span>    inside_unit_circle </span><span style="color:#72ab00;">= </span><span style="color:#a2a001;">list</span><span>(
</span><span>        </span><span style="color:#b39f04;">filter</span><span>(</span><span style="color:#72ab00;">lambda </span><span style="color:#5597d6;">c</span><span>: c[</span><span style="color:#b3933a;">0</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>c[</span><span style="color:#b3933a;">1</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>, coordinates)
</span><span>    )
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b39f04;">len</span><span>(inside_unit_circle)
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>    count </span><span style="color:#72ab00;">= </span><span style="color:#b39f04;">sum</span><span>(</span><span style="color:#b3933a;">1 </span><span style="color:#72ab00;">for </span><span style="color:#5597d6;">_ </span><span style="color:#72ab00;">in </span><span style="color:#b39f04;">filter</span><span>(</span><span style="color:#72ab00;">lambda </span><span style="color:#5597d6;">c</span><span>: c[</span><span style="color:#b3933a;">0</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">+ </span><span>c[</span><span style="color:#b3933a;">1</span><span>] </span><span style="color:#72ab00;">** </span><span style="color:#b3933a;">2 </span><span style="color:#72ab00;">&lt;= </span><span style="color:#b3933a;">1.0</span><span>, coordinates))
</span><span>    </span><span style="color:#b39f04;">print</span><span>(</span><span style="color:#b3933a;">4.0 </span><span style="color:#72ab00;">* </span><span>count </span><span style="color:#72ab00;">/ </span><span>n)
</span><span>
</span><span>
</span><span style="color:#5597d6;">main</span><span>()
</span></code></pre>
<p>And here is the result (the runtime for the above is considerably longer than
for profiling the runtime hotspots above):</p>
<pre data-lang="console" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-console "><code class="language-console" data-lang="console"><span>$ python example.py
</span><span>
</span><span>3.14176
</span><span>3.142728
</span><span>3.142728
</span><span>Filename: /home/bast/tmp/memory-profile/mem-example.py
</span><span>
</span><span>Line #    Mem usage    Increment  Occurrences   Line Contents
</span><span>=============================================================
</span><span>     5     17.3 MiB     17.3 MiB           1   @profile
</span><span>     6                                         def main():
</span><span>     7     17.3 MiB      0.0 MiB           1       n = 1000000
</span><span>     8
</span><span>     9     17.3 MiB      0.0 MiB           1       count = 0
</span><span>    10
</span><span>    11     17.3 MiB      0.0 MiB     1000001       for _ in range(n):
</span><span>    12                                                 # generate random coordinates between 0 and 1
</span><span>    13     17.3 MiB      0.0 MiB     1000000           x = random.random()
</span><span>    14     17.3 MiB      0.0 MiB     1000000           y = random.random()
</span><span>    15
</span><span>    16                                                 # check if the point is within the unit circle
</span><span>    17     17.3 MiB      0.0 MiB     1000000           if x**2 + y**2 &lt;= 1.0:
</span><span>    18     17.3 MiB      0.0 MiB      785440               count += 1
</span><span>    19
</span><span>    20                                             # calculate the approximate value of pi
</span><span>    21     17.3 MiB      0.0 MiB           1       print(4.0 * count / n)
</span><span>    22
</span><span>    23    148.8 MiB    131.6 MiB     1000003       coordinates = [(random.random(), random.random()) for _ in range(n)]
</span><span>    24
</span><span>    25    154.8 MiB      0.0 MiB           2       inside_unit_circle = list(
</span><span>    26    154.8 MiB      6.0 MiB     2000001           filter(lambda c: c[0] ** 2 + c[1] ** 2 &lt;= 1.0, coordinates)
</span><span>    27                                             )
</span><span>    28    154.8 MiB      0.0 MiB           1       count = len(inside_unit_circle)
</span><span>    29    154.8 MiB      0.0 MiB           1       print(4.0 * count / n)
</span><span>    30
</span><span>    31    154.8 MiB      0.0 MiB     3571367       count = sum(1 for _ in filter(lambda c: c[0] ** 2 + c[1] ** 2 &lt;= 1.0, coordinates))
</span><span>    32    154.8 MiB      0.0 MiB           1       print(4.0 * count / n)
</span></code></pre>


          </div>
        </div>
      </div>

      <div class="uk-margin-large-top">
        <hr>
        <ul class="uk-iconnav">
  <li class="uk-margin-large-right">
    <a href="mailto:radovan.bast@uit.no" uk-icon="icon: mail">radovan.bast@uit.no</a>
  </li>
  <li class="uk-margin-large-right">
    <a href="https://github.com/bast/R-and-Python" target="_blank" uk-icon="icon: github">github.com/bast/R-and-Python</a>
  </li>
</ul>

      </div>

    </div>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
  <script>
    anchors.add();
  </script>
</html>
